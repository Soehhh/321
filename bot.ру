import os
import telebot
import google.generativeai as genai

# Берем ключи
TELEGRAM_TOKEN = os.getenv('TELEGRAM_TOKEN')
GEMINI_KEY = os.getenv('GEMINI_KEY')

genai.configure(api_key=GEMINI_KEY)

# Пробуем разные варианты названий моделей
model_to_use = None
for name in ['gemini-1.5-flash', 'models/gemini-1.5-flash', 'gemini-pro']:
    try:
        model = genai.GenerativeModel(name)
        # Пробная генерация, чтобы проверить модель
        model_to_use = model
        print(f"Выбрана модель: {name}")
        break
    except:
        continue

bot = telebot.TeleBot(TELEGRAM_TOKEN)

@bot.message_handler(func=lambda m: True)
def chat(message):
    try:
        if not model_to_use:
            bot.reply_to(message, "Ошибка: Не удалось найти рабочую модель Gemini.")
            return
            
        response = model_to_use.generate_content(message.text)
        bot.reply_to(message, response.text)
    except Exception as e:
        bot.reply_to(message, f"Ошибка: {e}")

if name == "main":
    print("Бот запущен!")
    bot.infinity_polling(timeout=10, long_polling_timeout=5)
